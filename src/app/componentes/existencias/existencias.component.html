<div class="container mt-2">
    <div class="mb-2" [formGroup]="generalForm">
  <label class="form-label fw-bold mb-1">Buscar medicamento</label>

  <div class="d-flex align-items-center justify-content-between">
    <!-- Campo autocompletar -->
    <mat-form-field appearance="fill" class="flex-grow-1 me-3">
      <mat-label>Escriba el nombre del medicamento</mat-label>
      <input
        type="text"
        matInput
        formControlName="medicamento"
        [matAutocomplete]="automedicamento"
      />
      <mat-autocomplete
        #automedicamento="matAutocomplete"
        (optionSelected)="seleccionarMedicamento($event)"
      >
        <mat-option *ngFor="let option of medicamentosFiltrados" [value]="option">
          {{ option.nombre }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- Checkbox alineado -->
    <div class="form-check me-2 ms-auto d-flex align-items-center">
      <input
        class="form-check-input me-2"
        type="checkbox"
        formControlName="estado"
        id="filtroExistencias"
      />
      <label class="form-check-label" for="filtroExistencias">
        Mostrar solo con existencias
      </label>
    </div>

  <!-- Cards (Totales ingreso y egreso) -->
          <div class="col-md-3 d-flex gap-2">
            <div class="card shadow-sm text-center flex-fill border-0 bg-success-subtle d-flex align-items-center justify-content-center py-2">
              <div>
                <small class="text-success">Existencias</small>
                <div class="fw-bold text-success fs-6">{{ totalCantidadExistencia || 0 }}</div>
              </div>
            </div>

            <div class="card shadow-sm text-center flex-fill border-0 bg-info-subtle d-flex align-items-center justify-content-center py-2">
              <div>
                <small class="text-success">Canje</small>
                <div class="fw-bold text-warning fs-6">{{ totalCantidadCanje || 0 }}</div>
              </div>
            </div>

            <div class="card shadow-sm text-center flex-fill border-0 bg-danger-subtle d-flex align-items-center justify-content-center py-2">
              <div>
                <small class="text-danger">Pendientes</small>
                <div class="fw-bold text-danger fs-6">{{ totalCantidadPendiente || 0 }}</div>
              </div>
            </div>
          </div>     

  </div>
</div>


    <div *ngIf="listaItemBodega?.length > 0">
        <table class="table table-striped table-hover table-sm">
            <thead class="thead-colored">
                <tr>
                    <th>Item</th>
                    <th>ID</th>
                    <th>Nombre del medicamento</th>
                    <th>Cum</th>
                    <th>Presentación</th>
                    <th>Via</th>
                    <th>Bodega</th>
                    <th>Existencia</th>                    
                    <th>Prom. mes último trimestre</th>  
                    <th>Pendientes</th>  
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let itemt of listaItemBodega let i= index"
                   [ngStyle]="{'color': itemt.d_1>0 ? 'black' : 'red' }">
                    <td>{{i+1}}</td>
                    <td>{{itemt.id}}</td>
                    <td>{{itemt.dato_1}}</td>
                    <td>{{itemt.dato_2}}</td>
                    <td>{{itemt.dato_3}}</td>
                    <td>{{itemt.dato_4}}</td>
                    <td>{{itemt.dato_5}}</td>
                    <td style="color: green; text-align: right;"><strong>{{itemt.d_1}}</strong></td>
                  
                    <td style="text-align: center;"><strong>{{itemt.d_3}}</strong></td>

                    <td style="color: rgb(228, 16, 16); text-align: center;"><strong>{{itemt.d_2}}</strong></td>

                </tr>
            </tbody>
        </table>
    </div>

    <div *ngIf="listaItemEnvio?.length > 0">
        <div class="col-12 text-center">
            <span class="text-green">
                <strong> EXISTENCIA DEL MEDICAMENTO EN CANJE EN ESTADO ENVIO </strong>
            </span>
        </div>

        <table class="table table-striped table-hover table-sm mt-2">
            <thead class="thead-gradient-d">
                <tr>
                    <th>Orden</th>
                    <th>Fecha </th>
                    <th>Origen </th>
                    <th>Destino</th>
                    <th>Nombre Medicamento</th>
                    <th>Presentacion</th>
                    <th>Cantidad</th>

                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let itemt of listaItemEnvio let i= index">
                    <td>{{itemt.idDespacho}}</td>
                    <td>{{itemt.fechaDespacho | date: 'dd/MM/YYYY'}}</td>
                    <td>{{itemt.bodegaOrigen}}</td>
                    <td>{{itemt.bodegaDestino}}</td>
                    <td>{{itemt.nombreMedicamento}}</td>
                    <td>{{itemt.presentacion}}</td>
                    <td style="color: green; text-align: right;"><strong>{{itemt.cantidad}}</strong></td>

                </tr>
            </tbody>
        </table>
    </div>
</div>