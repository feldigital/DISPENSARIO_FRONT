<div class="container mt-2">

    <form [formGroup]="generalForm" class="px-2">
        <div class="row align-items-end g-2 mb-2">
            <!-- Selector de Bodega -->
            <div class="col-md-3">
                <label class="form-label mb-1 fw-bold">Bodega seleccionada</label>
                <select class="form-select form-select-sm" formControlName="idBodega">
                    <option selected [value]=0>TODAS LAS BODEGAS</option>
                    <option *ngFor="let item of listaregistros" [value]="item.idBodega">
                        {{ item.nombre }}
                    </option>
                </select>
            </div>

            <!-- Rango de Fechas -->
            <div class="col-md-4">
                <label class="form-label mb-1 fw-bold">Vencidos desde</label>
                <div class="d-flex gap-1">
                    <input type="date" formControlName="fechainicial" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Botón Buscar -->
            <div class="col-md-2 d-flex align-items-end">
                <button type="button" class="btn btn-info w-100 d-flex align-items-center justify-content-center"
                    (click)="buscarRegistro(parametro)">
                    <mat-icon class="me-1">search</mat-icon> Buscar
                </button>
            </div>

            <!-- Alerta: Total moléculas pendiente -->
            <div *ngIf="listaVencidosBodega?.length > 0" class="col-md-3 d-flex align-items-end">
                <div class="alert alert-danger d-flex align-items-center justify-content-center mb-0 w-100 py-2">
                    <small>
                        <strong>Moléculas vencidas a la fecha {{fechaFiltro| date: 'dd/MM/yyyy'}}:</strong> {{ listaVencidosBodega?.length || 0 }}
                    </small>
                </div>
            </div>
        </div>

        <!-- Buscador de Medicamento -->
        <div class="row g-2">
            <div class="col-md-12">
                <label class="form-label mb-1 fw-bold">Buscar medicamento</label>
                <div class="d-flex align-items-center">

                    <!-- Campo de búsqueda con ícono -->
                    <div class="input-group flex-grow-1 me-2">
                        <span class="input-group-text bg-white border-end-0">
                            <mat-icon class="text-info">search</mat-icon>
                        </span>
                        <input type="text" formControlName="listFilter"
                            class="form-control form-control-sm border-start-0"
                            placeholder="Digite el nombre del medicamento" />
                    </div>

                    <!-- Checkbox al lado derecho -->
                    <div class="form-check d-flex align-items-center ms-auto">

                    </div>
                </div>
            </div>
        </div>

    </form>




    <div class="alert alert-info my-2" *ngIf="listaVencidosBodega?.length == 0">
        No hay medicamentos penidientes, asociados a esta bodega en la fecha seleccionada!
    </div>




    <div *ngIf="listaVencidosBodega?.length > 0">
        <table class="table table-striped table-hover table-sm mt-2">
            <thead class="thead-colored">
                <tr>
                    <th>Item</th>  
                    <th *ngIf="todasBodega">Dispensario</th>           
                    <th>ID</th>
                    <th>Nombre del medicamento</th>
                    <th>Presentación</th>
                    <th>Existencia</th>
                    <th>Ult. Fecha Dotación</th>
                    <th>Pendientes</th>  
                    <th>Prom. mes último trimestre</th>  
                    <th>Invima</th>
                    <th>Laboratorio</th>
                    <th>Lote</th>
                    <th>Vencimiento</th>                

                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let itemt of listaVencidosBodegaFiltro let i= index">
                    <td>{{i+1}}</td>  
                    <td *ngIf="todasBodega">{{itemt.nombreBodega}}</td>                                  
                    <td>{{itemt.idMedicamento}}</td>
                    <td>{{itemt.nombre}}</td>
                    <td>{{itemt.forma}}</td>
                    <td style="color: green; text-align: right;"><strong>{{itemt.cantidad}}</strong></td>
                    <td>{{itemt.ultFecIngreso | date: 'dd/MM/YYYY'}}</td>
                    <td style="color: rgb(228, 16, 16); text-align: center;"><strong>{{itemt.pendiente}}</strong></td>
                    <td style="text-align: center;"><strong>{{itemt.cantidadEntregada}}</strong></td>
                    <td>{{itemt.invima}}</td>
                    <td>{{itemt.laboratorio}}</td>
                    <td>{{itemt.lote}}</td>
                    <td [ngStyle]="{ color: esFechaVencimientoProxima(itemt.fechaVencimiento) ? 'red' : 'inherit' }">
                          <div *ngIf="!itemt.editing">
                        {{itemt.fechaVencimiento | date: 'dd/MM/YYYY'}}
                        </div>
                    
                       
                        <div *ngIf="itemt.editing">
                            <input type="text" [(ngModel)]="itemt.invima" class="form-control" placeholder="Invima"/>
                            <input type="text" [(ngModel)]="itemt.laboratorio" class="form-control"  placeholder="Laboratorio"/>
                            <input type="text" [(ngModel)]="itemt.lote" class="form-control"  placeholder="Lote" />
                            <input style="color: rgb(228, 16, 16);" type="date" [(ngModel)]="itemt.fechaVencimiento" class="form-control" />                        
                        </div>
                 
                           <mat-icon  *ngIf="itemt.cantidad > 0 && !itemt.editing" title="Editar" class="puntero" style="font-size: 16px; color: #009A94;"  (click)="editarMedicamentoBodega(itemt)">list_alt</mat-icon>                      
                            <mat-icon *ngIf="itemt.editing" title="Guardar" class="puntero" [ngStyle]="{'color':'green'}" (click)="guardarMedicamentoBodega(itemt)">check</mat-icon>                       
                            <mat-icon *ngIf="itemt.editing"  class="puntero" title="Cancelar edición" [ngStyle]="{'color':'orange'}" (click)="cancelEdicion(itemt)">clear</mat-icon>

                      <!--      <mat-icon *ngIf="!itemt.estado" title="Eliminar medicamento" class="puntero" [ngStyle]="{'color':'red'}"  (click)="eliminarMedicamentoBodega(itemt)">delete_sweep</mat-icon>  -->
                    </td>

                </tr>
            </tbody>
        </table>
    </div>
</div>
